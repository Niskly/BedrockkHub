<script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const SUPABASE_URL = 'https://whxmfpdmnsungcwlffdx.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndoeG1mcGRtbnN1bmdjd2xmZmR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMDk3MzYsImV4cCI6MjA3MTg4NTczNn0.PED6DKwmfzUFLIvNbRGY2OQV5XXmc8WKS9E9Be6o8D8';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    document.getElementById('signup-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        // The user is only created here. The username etc. is handled on the next page.
        const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
        });

        if (error) {
            alert('Sign-up failed: ' + error.message);
        } else {
            alert('Account created! Now let\'s complete your profile.');
            // This is the key change: redirect to the new page.
            // Supabase automatically logs them in, so the next page will have their session.
            window.location.href = '/complete-profile.html';
        }
    });
</script>
